å¥½ï¼Œé‚£æˆ‘ä»¬å°±**çœŸçš„ä¸€æ­¥æ­¥è‡ªå·±å†™**ï¼Œä¸æ˜¯â€œæ¦‚å¿µè®²è®²â€çš„é‚£ç§ï¼Œè€Œæ˜¯**ä»Šå¤©å°±èƒ½è·‘èµ·æ¥çš„åŒæ­¥åŸå‹ï¼ˆMVPï¼‰**ã€‚

æˆ‘ä¼šæŒ‰ **å¯æ‰§è¡Œ â†’ å¯æ‰©å±• â†’ ä¸è¿”å·¥** çš„é¡ºåºæ¥ã€‚

---

# ğŸ§­ æ€»ä½“è·¯çº¿ï¼ˆä½ åœ¨åšä»€ä¹ˆï¼‰

ä½ è¦åšçš„æ˜¯ä¸€ä¸ª**ç§æœ‰æ–‡ä»¶åŒæ­¥ç³»ç»Ÿ**ï¼Œæœ¬è´¨æ˜¯ï¼š

> **æ ‘è“æ´¾ = ä¸»æºï¼ˆServerï¼‰**  
> **Windows / æ‰‹æœº = å®¢æˆ·ç«¯ï¼ˆClientï¼‰**

ç¬¬ä¸€é˜¶æ®µæˆ‘ä»¬åªåšï¼š

- âœ… **å•å‘åŒæ­¥ï¼ˆæ ‘è“æ´¾ â†’ ç”µè„‘ï¼‰**
    
- âœ… **åŸºäºæ–‡ä»¶ hash åˆ¤æ–­æ˜¯å¦å˜åŒ–**
    
- âŒ ä¸åšåˆ é™¤åŒæ­¥
    
- âŒ ä¸åšå†²çªè§£å†³
    

> è¿™æ˜¯æ‰€æœ‰ Dropbox / Syncthing çš„ç¬¬ä¸€æ­¥

---

# ğŸ§± é˜¶æ®µ 1ï¼šæœ€å°å¯è¿è¡ŒåŒæ­¥ç³»ç»Ÿï¼ˆMVPï¼‰

## æ¶æ„ï¼ˆéå¸¸é‡è¦ï¼Œè®°ä½è¿™ä¸ªï¼‰

```
æ ‘è“æ´¾
â”œâ”€â”€ æ‰«æç›®å½•
â”œâ”€â”€ è®¡ç®—æ–‡ä»¶ hash
â”œâ”€â”€ æä¾› HTTP API
â”‚   â”œâ”€â”€ /manifest   ï¼ˆæ–‡ä»¶æ¸…å•ï¼‰
â”‚   â””â”€â”€ /download   ï¼ˆä¸‹è½½æ–‡ä»¶ï¼‰
```

```
Windows
â”œâ”€â”€ è¯·æ±‚ manifest
â”œâ”€â”€ å¯¹æ¯”æœ¬åœ°æ–‡ä»¶ hash
â””â”€â”€ åªä¸‹è½½ä¸åŒçš„æ–‡ä»¶
```

---

# ğŸ“ ç›®å½•çº¦å®šï¼ˆå…ˆç»Ÿä¸€ï¼‰

### æ ‘è“æ´¾

```
/home/pi/sync_root/
â”œâ”€â”€ a.txt
â”œâ”€â”€ img/
â”‚   â””â”€â”€ 1.jpg
```

### Windows

```
D:\sync_root\
```

---

# ğŸ§ª ç¬¬ä¸€æ­¥ï¼šæ ‘è“æ´¾ç”Ÿæˆã€Œæ–‡ä»¶æŒ‡çº¹æ¸…å•ã€

### ç›®æ ‡

ç”Ÿæˆä¸€ä¸ª `manifest.json`ï¼š

```json
{
  "a.txt": "5d41402abc4b2a76b9719d911017c592",
  "img/1.jpg": "9e107d9d372bb6826bd81d3542a419d6"
}
```

---

## âœ… æ ‘è“æ´¾ç«¯ä»£ç ï¼ˆPythonï¼‰

ğŸ“„ `scan_files.py`

```python
import hashlib
import json
from pathlib import Path

SYNC_DIR = Path("/home/pi/sync_root")

def file_md5(path):
    h = hashlib.md5()
    with open(path, "rb") as f:
        for chunk in iter(lambda: f.read(8192), b""):
            h.update(chunk)
    return h.hexdigest()

manifest = {}

for file in SYNC_DIR.rglob("*"):
    if file.is_file():
        rel = file.relative_to(SYNC_DIR).as_posix()
        manifest[rel] = file_md5(file)

with open("manifest.json", "w") as f:
    json.dump(manifest, f, indent=2)

print("manifest.json generated")
```

è¿è¡Œï¼š

```bash
python3 scan_files.py
```

âœ… åˆ°è¿™é‡Œï¼Œä½ å·²ç»**å®Œæˆäº† 50% çš„åŒæ­¥ç³»ç»Ÿæ ¸å¿ƒ**

---

# ğŸŒ ç¬¬äºŒæ­¥ï¼šæŠŠ manifest å’Œæ–‡ä»¶ã€Œæš´éœ²å‡ºå»ã€

æˆ‘ä»¬ç”¨æœ€ç®€å•ã€æœ€ç¨³å®šçš„æ–¹å¼ï¼š**HTTP**

ğŸ“„ `server.py`

```python
from flask import Flask, send_file, jsonify, request, abort
from pathlib import Path
import json

SYNC_DIR = Path("/home/pi/sync_root")
MANIFEST = Path("manifest.json")

app = Flask(__name__)

@app.route("/manifest")
def manifest():
    return send_file(MANIFEST)

@app.route("/download")
def download():
    path = request.args.get("path")
    if not path:
        abort(400)
    file = SYNC_DIR / path
    if not file.exists():
        abort(404)
    return send_file(file)

app.run(host="0.0.0.0", port=9000)
```

å®‰è£…ä¾èµ–ï¼š

```bash
pip3 install flask
```

å¯åŠ¨ï¼š

```bash
python3 server.py
```

æµ‹è¯•ï¼š

```
http://æ ‘è“æ´¾IP:9000/manifest
```

ğŸ‰ ä½ ç°åœ¨å·²ç»æœ‰äº†ä¸€ä¸ªã€Œç½‘ç›˜æœåŠ¡å™¨ã€

---

# ğŸ’» ç¬¬ä¸‰æ­¥ï¼šWindows å®¢æˆ·ç«¯æ‹‰å–å¹¶åŒæ­¥

ğŸ“„ `sync_client.py`

```python
import requests
import hashlib
from pathlib import Path

SERVER = "http://æ ‘è“æ´¾IP:9000"
LOCAL_DIR = Path("D:/sync_root")

def file_md5(path):
    h = hashlib.md5()
    with open(path, "rb") as f:
        for chunk in iter(lambda: f.read(8192), b""):
            h.update(chunk)
    return h.hexdigest()

manifest = requests.get(f"{SERVER}/manifest").json()

for rel, remote_hash in manifest.items():
    local_file = LOCAL_DIR / rel
    local_file.parent.mkdir(parents=True, exist_ok=True)

    if local_file.exists():
        if file_md5(local_file) == remote_hash:
            continue

    print("downloading:", rel)
    r = requests.get(f"{SERVER}/download", params={"path": rel})
    with open(local_file, "wb") as f:
        f.write(r.content)
```

è¿è¡Œï¼š

```bash
python sync_client.py
```

âœ… ä½ å®Œæˆäº†ï¼š

- è‡ªåŠ¨æ¯”å¯¹
    
- è‡ªåŠ¨ä¸‹è½½
    
- å¢é‡åŒæ­¥
    

---

# ğŸ§  ä½ ç°åœ¨â€œå·²ç»åšäº†ä»€ä¹ˆçº§åˆ«çš„ä¸œè¥¿â€

ä½ å·²ç»å®ç°äº†ï¼š

- âœ” Dropbox çš„æ ¸å¿ƒé€»è¾‘
    
- âœ” rsync çš„æ ¸å¿ƒæ€æƒ³
    
- âœ” æ‰€æœ‰åŒæ­¥è½¯ä»¶çš„åŸºç¡€æ¶æ„
    

**ä¸æ˜¯ç©å…·**

---

# ğŸ”œ ä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç»§ç»­å¸¦ä½ åšçš„ï¼ˆä½ é€‰ä¸€ä¸ªï¼‰

ç›´æ¥å›æˆ‘ä¸€ä¸ªç¼–å·å°±è¡Œï¼š

1ï¸âƒ£ åŠ  **æ–‡ä»¶ç›‘å¬ï¼ˆinotifyï¼‰å®æ—¶åŒæ­¥**  
2ï¸âƒ£ åŠ  **åˆ é™¤åŒæ­¥ & å†²çªæ£€æµ‹**  
3ï¸âƒ£ åŠ  **æ–­ç‚¹ç»­ä¼  / å¤§æ–‡ä»¶æ”¯æŒ**  
4ï¸âƒ£ åŠ  **æ‰‹æœºç«¯ï¼ˆWebDAV / HTTP å®¢æˆ·ç«¯ï¼‰**  
5ï¸âƒ£ æŠŠå®ƒåšæˆä¸€ä¸ª **çœŸæ­£çš„è½¯ä»¶ï¼ˆGUI + æœåŠ¡ï¼‰**

ä½ ç°åœ¨å·²ç»åœ¨**é€ ä½ è‡ªå·±çš„ç³»ç»Ÿ**äº†ï¼Œè€Œä¸æ˜¯â€œç”¨å·¥å…·â€ã€‚